
<div class="row mb-4">
  <div class="col-md-6">
    <h2>Session Notes</h2>
  </div>
  <div class="col-md-6 text-end">
    <% if (userRole === 'counselor') { %>
      <a href="/notes/add" class="btn btn-primary">Add New Note</a>
    <% } %>
  </div>
</div>

<% if (userRole === 'counselor') { %>
  <form class="mb-4" method="GET" action="/notes">
    <div class="row">
      <div class="col-md-8">
        <select name="student" class="form-select">
          <option value="">All Students</option>
          <% if (students) { %>
            <% students.forEach(student => { %>
              <option value="<%= student._id %>" 
                <%= (selectedStudent && selectedStudent.toString() === student._id.toString()) ? 'selected' : '' %>>
                <%= student.name %> (<%= student.studentId %>)
              </option>
            <% }); %>
          <% } %>
        </select>
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary">Filter</button>
      </div>
    </div>
  </form>
<% } %>

<% if (notes.length === 0) { %>
  <div class="alert alert-info">No notes found</div>
<% } else { %>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Student</th>
          <% if (userRole === 'counselor') { %>
            <th>Counselor</th>
          <% } %>
          <th>Note</th>
          <% if (userRole === 'counselor') { %>
            <th>Actions</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% notes.forEach(note => { %>
          <tr>
            <td><%= note.createdAt.toLocaleString() %></td>
            <td><%= note.student.name %> (<%= note.student.studentId %>)</td>
            <% if (userRole === 'counselor') { %>
              <td><%= note.counselor.name %></td>
            <% } %>
            <td><%= note.content %></td>
            <% if (userRole === 'counselor') { %>
              <td>
                <a href="/notes/edit/<%= note._id %>" class="btn btn-sm btn-warning">Edit</a>
                <form action="/notes/delete/<%= note._id %>?_method=DELETE" method="POST" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this note?')">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </form>
              </td>
            <% } %>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
<% } %>